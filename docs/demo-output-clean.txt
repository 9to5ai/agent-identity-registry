
============================================================
  Agent Identity Registry - Demo Scenario
============================================================

Target: http://localhost:8000
Time: 2026-02-14T21:35:13.587099
[Step 0] Resetting database for clean demo...
  âœ“ Database reset


============================================================
  PHASE 1: Agent Registration
============================================================

[Step 1] Human (Jun) authorizes Agent A ('DataAnalyzer')
  â†’ Jun wants to analyze customer data
  â†’ Scope: read:database, write:reports, create:charts

  Response:
{
  "agent_id": "agent_bc0380d28a45709b",
  "credentials": {
    "api_key": "air_9q7pKEDEeklZlUyHCcqVdpU90FIuDtym75zeEkSyB7Q",
    "expires_at": 1802601313
  }
}

  âœ“ Agent A registered with ID: agent_bc0380d28a45709b

============================================================
  PHASE 2: Delegation Chain
============================================================

[Step 2] Agent A spawns Agent B ('ReportGenerator')
  â†’ Agent A needs help generating reports
  â†’ Scope: write:reports (subset of A's scope)

  Response:
{
  "agent_id": "agent_5696f112e3a94804",
  "credentials": {
    "api_key": "air_f2fCn_iZEydNxY6Ab7xMbKJVoV4gFRvs0NjBeSXJ2nk",
    "expires_at": 1802601313
  },
  "delegation_chain": [
    {
      "type": "human",
      "id": "user:jun@apra.gov.au",
      "name": null
    },
    {
      "type": "agent",
      "id": "agent_bc0380d28a45709b",
      "name": "DataAnalyzer"
    },
    {
      "type": "agent",
      "id": "agent_5696f112e3a94804",
      "name": "ReportGenerator"
    }
  ],
  "delegation_depth": 1
}

  âœ“ Agent B spawned with delegation depth: 1
  âœ“ Delegation chain: user:jun@apra.gov.au â†’ DataAnalyzer â†’ ReportGenerator
[Step 3] Agent B spawns Agent C ('ChartMaker')
  â†’ Agent B needs help creating charts
  â†’ BUT Agent B only has 'write:reports' scope...

  â†’ First, try requesting 'create:charts' (outside B's scope):

  Response (expected failure):
{
  "detail": "Scope attenuation violation: ['create:charts'] not in parent scope"
}

  âœ“ Scope attenuation enforced! Agent C can't have more permissions than B

  â†’ Now let's have Agent A spawn Agent C directly:

  Response:
{
  "agent_id": "agent_377514c491a5e940",
  "credentials": {
    "api_key": "air_eow97YNsb-Y-8ayUWZCHdJVBBsVOlDHBxfxIWQay5dc",
    "expires_at": 1802601313
  },
  "delegation_chain": [
    {
      "type": "human",
      "id": "user:jun@apra.gov.au",
      "name": null
    },
    {
      "type": "agent",
      "id": "agent_bc0380d28a45709b",
      "name": "DataAnalyzer"
    },
    {
      "type": "agent",
      "id": "agent_377514c491a5e940",
      "name": "ChartMaker"
    }
  ],
  "delegation_depth": 1
}

  âœ“ Agent C spawned successfully from Agent A

============================================================
  PHASE 3: Agent Actions (Audit Trail)
============================================================

[Step 4] Agent A reads customer database
  â†’ Action: read:database
  â†’ Resource: customers_table
  â†’ Human authority traced: user:jun@apra.gov.au

[Step 5] Agent A reads transactions
  â†’ Action: read:database
  â†’ Resource: transactions_table
  â†’ Human authority traced: user:jun@apra.gov.au

[Step 6] Agent B generates Q1 report
  â†’ Action: write:reports
  â†’ Resource: quarterly_report.pdf
  â†’ Human authority traced: user:jun@apra.gov.au

[Step 7] Agent C creates sales chart
  â†’ Action: create:charts
  â†’ Resource: sales_chart.png
  â†’ Human authority traced: user:jun@apra.gov.au

[Step 8] Agent A compiles final analysis
  â†’ Action: write:reports
  â†’ Resource: final_analysis.pdf
  â†’ Human authority traced: user:jun@apra.gov.au


============================================================
  PHASE 4: Forensic Queries
============================================================

[Step 9] Query: 'Show me Agent C's full audit trace'
  â†’ Who authorized Agent C? What has it done?

  Delegation Chain:
    â”œâ”€ ðŸ‘¤ user:jun@apra.gov.au
    â”œâ”€ ðŸ¤– DataAnalyzer (agent_bc0380d28a...)
    â””â”€ ðŸ¤– ChartMaker (agent_377514c491...)

  âœ“ Every action by Agent C traces back to: user:jun@apra.gov.au
[Step 10] Query: 'Show all actions authorized by Jun'

  Found 5 actions authorized by Jun:

  â€¢ [write:reports] final_analysis.pdf by DataAnalyzer
  â€¢ [create:charts] sales_chart.png by ChartMaker
  â€¢ [write:reports] quarterly_report.pdf by ReportGenerator
  â€¢ [read:database] transactions_table by DataAnalyzer
  â€¢ [read:database] customers_table by DataAnalyzer


============================================================
  DEMO COMPLETE
============================================================


  Summary:
  â€¢ Agents registered: 3
  â€¢ Actions logged: 5
  â€¢ All actions trace back to human authority
  
  Key Concepts Demonstrated:
  âœ“ Agent Identity: Each agent has unique ID (not shared API keys)
  âœ“ Delegation: Sub-agents inherit bounded authority from parents
  âœ“ Scope Attenuation: Child can't have MORE permissions than parent
  âœ“ Audit Trail: Every action logged with delegation chain
  âœ“ Forensic Queries: Can trace any action to human authority
  
  Explore the API:
  â€¢ Swagger docs: http://localhost:8000/docs
  â€¢ Agent list: http://localhost:8000/agents
  â€¢ Audit logs: http://localhost:8000/audit/query

